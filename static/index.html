<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Broadband Usage</title>

		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
		<script type="text/javascript" src="http://code.highcharts.com/stock/highstock.js"></script>

		<script type="text/javascript">
			
		$(document).ready(function() {
			function afterSetExtremes(e) {
				$.get('/data/?start='+e.min+'&end='+e.max, {}, function(rawData) {
					var chart = $("#container").highcharts();
					var data = JSON.parse(rawData);
					chart.series[0].setData(data[0]);
					chart.series[1].setData(data[1]);
				});
			};

			var options = {
				chart: {
					type: 'line',
					zoomType: 'xy'
				},
				title: {
					text: 'Broadband Usage'
				},
				rangeSelector: {
					inputDateFormat: '%Y-%m-%d',
					inputEditDateFormat: '%Y-%m-%d',
					allButtonsEnabled:  true,
					buttons: [{
						type: 'hour',
						count: 1,
						text: '1h'
					}, {
						type: 'day',
						count: 1,
						text: '1d'
					}, {
						type: 'month',
						count: 1,
						text: '1m'
					}, {
						type: 'year',
						count: 1,
						text: '1y'
					}, {
						type: 'all',
						text: 'All'
					}],
				},


				legend: {
					enabled: true,
				},
				xAxis: {
					type: 'datetime',
					title: {
						text: 'Time'
					},
					crosshair: true,
					dateTimeLabelFormats: {
						day: '%Y-%m-%d',
						year: '%Y'
					},
					events : {
						afterSetExtremes : afterSetExtremes
					},
					minRange: 60 * 60 * 1000,
				},
				yAxis: {
					min: 0,
					title: {
						text: 'GB'
					}
				},
				scrollbar: {
					liveRedraw: false
				},
				plotOptions: {
					line: {
						gapSize: 2,
					},
				},
				tooltip: {
					xDateFormat: '<b>%Y-%m-%d %H:%M:%S</b>',
					shared: true,
					pointFormatter: function() {
						var d = new Date(this.x);
						return "<b>" + d.toLocaleTimeString() + ": </b>" + Math.round(100*this.y/(1000*1000*1000))/100 + " GB <br />";
					}
				},
			};
			$.get('/data/', {}, function(rawData) {
				var chart = $("#container").highcharts("StockChart", options).highcharts();
				var data = JSON.parse(rawData);
				chart.addSeries({ name: "Quota Total", data: data[0] });
				chart.addSeries({ name: "Quota Remaining", data: data[1] });
			});
		});
		</script>

	</head>
	<body>
		<div id="container" style="width: 1000px; height: 600px; margin: 0 auto"></div>
	</body>
</html>
